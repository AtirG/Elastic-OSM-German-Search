# OSM Extraction â€“ Germany

## Goal
Extract cities, streets, and address points from the Germany OpenStreetMap `.pbf` file. This stage transforms graph-based OSM data into row-based CSV files for the pipeline.

---

## Chronological Execution Flow

The extraction process is split into three scripts that should be executed in order:

### 1. [01_extract_osm.py](file:///Users/atirgabay/PycharmProjects/osm-germany-address-search/pipeline/extract/01_extract_osm.py)
Extracts city nodes and street ways.
- **`CityHandler`**: Extracts nodes with `place` tags (`city`, `town`, `village`).
- **`StreetHandler`**: Extracts ways with `highway` tags and associates them with the nearest city via a KD-Tree.

### 2. [02_extract_places_buildings.py](file:///Users/atirgabay/PycharmProjects/osm-germany-address-search/pipeline/extract/02_extract_places_buildings.py)
Extracts buildings and specific address nodes.
- **`AddressHandler.node`**: Extracts nodes with `addr:housenumber`.
- **`AddressHandler.way`**: Extracts ways with `building` tags and computes centroids.

### 3. [03_extract_cities_boundries.py](file:///Users/atirgabay/PycharmProjects/osm-germany-address-search/pipeline/extract/03_extract_cities_boundries.py)
Extracts administrative boundaries for geo-enrichment.
- **`AdminBoundaryHandler`**: Filters for `boundary=administrative` at levels 2, 4, 6, and 8.

---

## Technical Specifications

### Output Files
| File | Generated By |
| :--- | :--- |
| `cities.csv` | `01_extract_osm.py` |
| `streets.csv` | `01_extract_osm.py` |
| `addresses.csv` | `02_extract_places_buildings.py` |
| `cities_boundaries.geojson` | `03_extract_cities_boundries.py` |

---

## Usage

Run the scripts in the following order:

```bash
python pipeline/extract/01_extract_osm.py data/germany-latest.osm.pbf
python pipeline/extract/02_extract_places_buildings.py data/germany-latest.osm.pbf
python pipeline/extract/03_extract_cities_boundries.py
```